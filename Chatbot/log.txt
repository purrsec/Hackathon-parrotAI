   âœ… Plan de vol gÃ©nÃ©rÃ©: 6 commandes
      1. takeoff - DÃ©collage Ã  50m d'altitude
      2. goto - Navigation vers Centrale de Fessenheim (47.9094, 7.5603) Ã  50m
      3. circle - Orbite autour de Centrale de Fessenheim (rayon: 200m)
      4. capture - Capture d'une photo de Centrale de Fessenheim
      5. rth - Retour au point de dÃ©part
      6. land - Atterrissage

ğŸ“¤ RÃ©ponse finale envoyÃ©e au client:
   - Message: Voici ce que jâ€™ai prÃ©parÃ© pour la mission dâ€™inspection de la centrale de Fessenheim.

Ce que jâ€™ai fa...
   - Tool calls: 4
   - Plan de vol: 6 commandes
ğŸ¤– ========== FIN Ã‰CHANGE IA ==========

 POST /api/chat 200 in 39922ms
 GET / 200 in 16ms

ğŸ¤– ========== DÃ‰BUT Ã‰CHANGE IA ==========
ğŸ“¤ Provider: Azure OpenAI
ğŸ“ Messages utilisateur: [
  {
    "role": "assistant",
    "content": "Bonjour ! Je suis votre assistant pour contrÃ´ler le drone. Comment puis-je vous aider ? Par exemple, vous pouvez me demander : \"Va voir si la centrale de Fessenheim a Ã©tÃ© touchÃ©e\""
  },
  {
    "role": "user",
    "content": "decolle Ã  50m stp"
  }
]
ğŸ”§ System Prompt: Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :

1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les s...
ğŸ› ï¸  Tools disponibles: getCoordonnees, getEtatInitial, getZoneInterdite, planMissionRecon, takeOff, goTo, circle, capture, returnToHome, land, getStatus

ğŸ“¡ Appel initial Ã  l'IA...

ğŸŒ Appel API Azure OpenAI
   - Tool choice: auto
   - Nombre de messages: 3
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{},"finish_reason":"tool_calls","index":0,"logprobs":null,"message":{"annotations":[],"content":null,"refusal":null,"role":"assistant","tool_calls":[{"function":{"arguments":"{\"alt_m\":50}","name":"takeOff"},"id":"call_9VJizavxmU4kJ6TxJPNGa558","type":"function"}]}}],"created":1762542479,"id":"chatcmpl-CZM6RrOFaj6J0G7fgAOa69PgHNzT2","model":"gpt-5-2025-08-07","object":"chat.completion","prompt_filter_results":[{"prompt_index":0,"content_filter_results":{"ha...
ğŸ“¥ RÃ©ponse IA reÃ§ue:
   - Contenu: (vide)
   - Tool calls: 1
   - Tool 1: takeOff
     Arguments: "{\"alt_m\":50}"

ğŸ”„ Tour 1/5

ğŸ”§ 1 outil(s) Ã  exÃ©cuter:

âš™ï¸  ExÃ©cution: takeOff
   ParamÃ¨tres: {
  "alt_m": 50
}
   âœ… RÃ©sultat: {
  "id": "cmd_1762542487951",
  "status": "success",
  "message": "DÃ©collage rÃ©ussi Ã  50m",
  "data": {
    "altitude": 50,
    "state": "hovering"
  }
}

ğŸ“Š Ã‰tat actuel:
   - CoordonnÃ©es rÃ©cupÃ©rÃ©es: false
   - Ã‰tat initial rÃ©cupÃ©rÃ©: false
   - Zones interdites rÃ©cupÃ©rÃ©es: false
   - Plans de mission gÃ©nÃ©rÃ©s: false
   - Nombre de sites: 0

ğŸ’¬ GÃ©nÃ©ration de la rÃ©ponse finale...
ğŸ“¤ Contexte complet: 6 messages
   - Tool calls effectuÃ©s: 1
   - RÃ©flexion IA: (aucune)

ğŸŒ Appel API Azure OpenAI
   - Tool choice: none
   - Nombre de messages: 6
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{"hate":{"filtered":false,"severity":"safe"},"protected_material_code":{"filtered":false,"detected":false},"protected_material_text":{"filtered":false,"detected":false},"self_harm":{"filtered":false,"severity":"safe"},"sexual":{"filtered":false,"severity":"safe"},"violence":{"filtered":false,"severity":"safe"}},"finish_reason":"stop","index":0,"logprobs":null,"message":{"annotations":[],"content":"DÃ©collage effectuÃ©. Le drone est en vol stationnaire Ã  50 m d...
ğŸ“¥ RÃ©ponse finale IA:
   - Contenu: DÃ©collage effectuÃ©. Le drone est en vol stationnaire Ã  50 m dâ€™altitude, prÃªt pour la prochaine instruction.

Souhaitez-vous que je:
- me dirige vers un point ou un site prÃ©cis,
- effectue une orbite autour dâ€™une cible,
- capture une photo ou lance une vidÃ©o,
- prÃ©pare une mission dâ€™inspection sur un ou plusieurs sites (je rÃ©cupÃ©rerai automatiquement les coordonnÃ©es, vÃ©rifierai les zones interdites et gÃ©nÃ©rerai le plan pour chaque site),
- ou que je revienne au point de dÃ©part/atterrisse ?

âœˆï¸  GÃ©nÃ©ration du plan de vol...
   - CoordonnÃ©es disponibles: false
   - Ã‰tat initial disponible: false
   âš ï¸  Plan de vol non gÃ©nÃ©rÃ© (donnÃ©es insuffisantes)

ğŸ“¤ RÃ©ponse finale envoyÃ©e au client:
   - Message: DÃ©collage effectuÃ©. Le drone est en vol stationnaire Ã  50 m dâ€™altitude, prÃªt pour la prochaine instr...
   - Tool calls: 1
   - Plan de vol: 0 commandes
ğŸ¤– ========== FIN Ã‰CHANGE IA ==========

 POST /api/chat 200 in 20649ms

ğŸ¤– ========== DÃ‰BUT Ã‰CHANGE IA ==========
ğŸ“¤ Provider: Azure OpenAI
ğŸ“ Messages utilisateur: [
  {
    "role": "assistant",
    "content": "Bonjour ! Je suis votre assistant pour contrÃ´ler le drone. Comment puis-je vous aider ? Par exemple, vous pouvez me demander : \"Va voir si la centrale de Fessenheim a Ã©tÃ© touchÃ©e\""
  },
  {
    "role": "user",
    "content": "decolle Ã  50m stp"
  },
  {
    "role": "assistant",
    "content": "DÃ©collage effectuÃ©. Le drone est en vol stationnaire Ã  50 m dâ€™altitude, prÃªt pour la prochaine instruction.\n\nSouhaitez-vous que je:\n- me dirige vers un point ou un site prÃ©cis,\n- effectue une orbite autour dâ€™une cible,\n- capture une photo ou lance une vidÃ©o,\n- prÃ©pare une mission dâ€™inspection sur un ou plusieurs sites (je rÃ©cupÃ©rerai automatiquement les coordonnÃ©es, vÃ©rifierai les zones interdites et gÃ©nÃ©rerai le plan pour chaque site),\n- ou que je revienne au point de dÃ©part/atterrisse ?"
  },
  {
    "role": "user",
    "content": "va en 1000 523 120"
  }
]
ğŸ”§ System Prompt: Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :

1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les s...
ğŸ› ï¸  Tools disponibles: getCoordonnees, getEtatInitial, getZoneInterdite, planMissionRecon, takeOff, goTo, circle, capture, returnToHome, land, getStatus

ğŸ“¡ Appel initial Ã  l'IA...

ğŸŒ Appel API Azure OpenAI
   - Tool choice: auto
   - Nombre de messages: 5
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{"hate":{"filtered":false,"severity":"safe"},"protected_material_code":{"filtered":false,"detected":false},"protected_material_text":{"filtered":false,"detected":false},"self_harm":{"filtered":false,"severity":"safe"},"sexual":{"filtered":false,"severity":"safe"},"violence":{"filtered":false,"severity":"safe"}},"finish_reason":"stop","index":0,"logprobs":null,"message":{"annotations":[],"content":"Les coordonnÃ©es â€œ1000 523 120â€ ne sont pas des valeurs GPS va...
ğŸ“¥ RÃ©ponse IA reÃ§ue:
   - Contenu: Les coordonnÃ©es â€œ1000 523 120â€ ne sont pas des valeurs GPS valides (latitude doit Ãªtre entre âˆ’90 et 90, longitude entre âˆ’180 et 180). 

Pouvez-vous prÃ©ciser:
- des coordonnÃ©es GPS au format â€œlatitude, longitude, altitude en mÃ¨tresâ€ (ex: 48.8584, 2.2945, 120), 
- ou le nom dâ€™un site/dâ€™une adresse pour que je le localise et envoie le drone ? 

Si vous vouliez dire 10.00 de latitude, 5.23 de longitude, altitude 120 m, je peux y aller dÃ¨s confirmation.
   - Tool calls: 0

ğŸ”„ Tour 1/5

ğŸ’¬ GÃ©nÃ©ration de la rÃ©ponse finale...
ğŸ“¤ Contexte complet: 6 messages
   - Tool calls effectuÃ©s: 0
   - RÃ©flexion IA: (aucune)

ğŸŒ Appel API Azure OpenAI
   - Tool choice: none
   - Nombre de messages: 6
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{"hate":{"filtered":false,"severity":"safe"},"protected_material_code":{"filtered":false,"detected":false},"protected_material_text":{"filtered":false,"detected":false},"self_harm":{"filtered":false,"severity":"safe"},"sexual":{"filtered":false,"severity":"safe"},"violence":{"filtered":false,"severity":"safe"}},"finish_reason":"stop","index":0,"logprobs":null,"message":{"annotations":[],"content":"Je peux envoyer le drone vers un point GPS, mais â€œ1000 523 12...
ğŸ“¥ RÃ©ponse finale IA:
   - Contenu: Je peux envoyer le drone vers un point GPS, mais â€œ1000 523 120â€ ne correspond pas Ã  des coordonnÃ©es latitude/longitude valides (lat âˆˆ [-90; 90], lon âˆˆ [-180; 180]). Merci de prÃ©ciser le point au bon format ou de clarifier le systÃ¨me de coordonnÃ©es utilisÃ©.

Formats acceptÃ©s:
- DegrÃ©s dÃ©cimaux (WGS84): latitude, longitude, altitude_m (ex: 48.85837, 2.29448, 120)
- DMS: 48Â°51'29.6"N 2Â°17'40.1"E, 120 m
- UTM/MGRS: indiquer zone, bande/hÃ©misphÃ¨re et easting/northing (ex: 31U 448251 5411932, altitude 120 m)
- Nom dâ€™un lieu/adresse: je peux convertir en coordonnÃ©es
- Plus code: ex: 8FW4V75V+QC, altitude 120 m

Si vous vouliez dire â€œ10.00, 5.23, 120 mâ€, confirmez-le. Indiquez Ã©galement la vitesse souhaitÃ©e (en m/s) si diffÃ©rente; Ã  dÃ©faut, jâ€™utiliserai la vitesse de croisiÃ¨re. Avant lâ€™envoi, je vÃ©rifierai les zones Ã  Ã©viter le long de la trajectoire.

ğŸ“¤ RÃ©ponse finale envoyÃ©e au client:
   - Message: Je peux envoyer le drone vers un point GPS, mais â€œ1000 523 120â€ ne correspond pas Ã  des coordonnÃ©es ...
   - Tool calls: 0
   - Plan de vol: 0 commandes
ğŸ¤– ========== FIN Ã‰CHANGE IA ==========

 POST /api/chat 200 in 46456ms
^C

hrandriama : ~/Bureau/EDTH(main *+) â–¸ npm run dev

> edth-drone-chatbot@1.0.0 dev
> next dev

  â–² Next.js 14.2.33
  - Local:        http://localhost:3000
  - Environments: .env.local

 âœ“ Starting...
 âœ“ Ready in 1779ms
 â—‹ Compiling /api/chat ...
 âœ“ Compiled /api/chat in 882ms (203 modules)

ğŸ¤– ========== DÃ‰BUT Ã‰CHANGE IA ==========
ğŸ“¤ Provider: Azure OpenAI
ğŸ“ Messages utilisateur: [
  {
    "role": "assistant",
    "content": "Bonjour ! Je suis votre assistant pour contrÃ´ler le drone. Comment puis-je vous aider ? Par exemple, vous pouvez me demander : \"Va voir si la centrale de Fessenheim a Ã©tÃ© touchÃ©e\""
  },
  {
    "role": "user",
    "content": "decolle Ã  50m stp"
  },
  {
    "role": "assistant",
    "content": "DÃ©collage effectuÃ©. Le drone est en vol stationnaire Ã  50 m dâ€™altitude, prÃªt pour la prochaine instruction.\n\nSouhaitez-vous que je:\n- me dirige vers un point ou un site prÃ©cis,\n- effectue une orbite autour dâ€™une cible,\n- capture une photo ou lance une vidÃ©o,\n- prÃ©pare une mission dâ€™inspection sur un ou plusieurs sites (je rÃ©cupÃ©rerai automatiquement les coordonnÃ©es, vÃ©rifierai les zones interdites et gÃ©nÃ©rerai le plan pour chaque site),\n- ou que je revienne au point de dÃ©part/atterrisse ?"
  },
  {
    "role": "user",
    "content": "va en 1000 523 120"
  },
  {
    "role": "assistant",
    "content": "Je peux envoyer le drone vers un point GPS, mais â€œ1000 523 120â€ ne correspond pas Ã  des coordonnÃ©es latitude/longitude valides (lat âˆˆ [-90; 90], lon âˆˆ [-180; 180]). Merci de prÃ©ciser le point au bon format ou de clarifier le systÃ¨me de coordonnÃ©es utilisÃ©.\n\nFormats acceptÃ©s:\n- DegrÃ©s dÃ©cimaux (WGS84): latitude, longitude, altitude_m (ex: 48.85837, 2.29448, 120)\n- DMS: 48Â°51'29.6\"N 2Â°17'40.1\"E, 120 m\n- UTM/MGRS: indiquer zone, bande/hÃ©misphÃ¨re et easting/northing (ex: 31U 448251 5411932, altitude 120 m)\n- Nom dâ€™un lieu/adresse: je peux convertir en coordonnÃ©es\n- Plus code: ex: 8FW4V75V+QC, altitude 120 m\n\nSi vous vouliez dire â€œ10.00, 5.23, 120 mâ€, confirmez-le. Indiquez Ã©galement la vitesse souhaitÃ©e (en m/s) si diffÃ©rente; Ã  dÃ©faut, jâ€™utiliserai la vitesse de croisiÃ¨re. Avant lâ€™envoi, je vÃ©rifierai les zones Ã  Ã©viter le long de la trajectoire."
  },
  {
    "role": "user",
    "content": "va en latitude, longitude, altitude_m (ex: 48.85837, 2.29448, 120) stp"
  }
]
ğŸ”§ System Prompt: Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :

1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les s...
ğŸ› ï¸  Tools disponibles: getCoordonnees, getEtatInitial, getZoneInterdite, planMissionRecon, takeOff, goTo, circle, capture, returnToHome, land, getStatus

ğŸ“¡ Appel initial Ã  l'IA...

ğŸŒ Appel API Azure OpenAI
   - Tool choice: auto
   - Nombre de messages: 7
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
 âœ“ Compiled in 191ms (203 modules)
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{},"finish_reason":"tool_calls","index":0,"logprobs":null,"message":{"annotations":[],"content":null,"refusal":null,"role":"assistant","tool_calls":[{"function":{"arguments":"{\"alt_m\":50}","name":"takeOff"},"id":"call_EDlnjJRBVpLD4gHYqzh5FtdE","type":"function"}]}}],"created":1762542661,"id":"chatcmpl-CZM9N5lFJ09ZhjvMqdCHS0Uj98L29","model":"gpt-5-2025-08-07","object":"chat.completion","prompt_filter_results":[{"prompt_index":0,"content_filter_results":{"ha...
ğŸ“¥ RÃ©ponse IA reÃ§ue:
   - Contenu: (vide)
   - Tool calls: 1
   - Tool 1: takeOff
     Arguments: "{\"alt_m\":50}"

ğŸ”„ Tour 1/5

ğŸ”§ 1 outil(s) Ã  exÃ©cuter:

âš™ï¸  ExÃ©cution: takeOff
   ParamÃ¨tres: {
  "alt_m": 50
}
(node:81961) [DEP0169] DeprecationWarning: `url.parse()` behavior is not standardized and prone to errors that have security implications. Use the WHATWG URL API instead. CVEs are not issued for `url.parse()` vulnerabilities.
(Use `node --trace-deprecation ...` to show where the warning was created)
 POST /api/chat 200 in 32636ms
 â—‹ Compiling / ...
 âœ“ Compiled / in 3.1s (655 modules)
 GET / 200 in 3239ms
 âœ“ Compiled in 217ms (243 modules)
   âœ… RÃ©sultat: {
  "id": "cmd_1762542690762",
  "status": "error",
  "message": "Ã‰chec du dÃ©collage",
  "data": {}
}

ğŸ“Š Ã‰tat actuel:
   - CoordonnÃ©es rÃ©cupÃ©rÃ©es: false
   - Ã‰tat initial rÃ©cupÃ©rÃ©: false
   - Zones interdites rÃ©cupÃ©rÃ©es: false
   - Plans de mission gÃ©nÃ©rÃ©s: false
   - Nombre de sites: 0

ğŸ’¬ GÃ©nÃ©ration de la rÃ©ponse finale...
ğŸ“¤ Contexte complet: 10 messages
   - Tool calls effectuÃ©s: 1
   - RÃ©flexion IA: (aucune)

ğŸŒ Appel API Azure OpenAI
   - Tool choice: none
   - Nombre de messages: 10
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{"hate":{"filtered":false,"severity":"safe"},"protected_material_code":{"filtered":false,"detected":false},"protected_material_text":{"filtered":false,"detected":false},"self_harm":{"filtered":false,"severity":"safe"},"sexual":{"filtered":false,"severity":"safe"},"violence":{"filtered":false,"severity":"safe"}},"finish_reason":"stop","index":0,"logprobs":null,"message":{"annotations":[],"content":"Mise Ã  jour: jâ€™ai tentÃ© de faire dÃ©coller le drone Ã  50 m, ma...
ğŸ“¥ RÃ©ponse finale IA:
   - Contenu: Mise Ã  jour: jâ€™ai tentÃ© de faire dÃ©coller le drone Ã  50 m, mais la commande systÃ¨me a Ã©chouÃ©. Le drone est toujours au sol.

Pour lâ€™envoi vers une destination, jâ€™ai besoin de coordonnÃ©es valides. Merci de fournir un point au bon format:
- DegrÃ©s dÃ©cimaux (WGS84): latitude, longitude, altitude_m (ex: 48.85837, 2.29448, 120)
- DMS: 48Â°51'29.6"N 2Â°17'40.1"E, 120 m
- UTM/MGRS: zone, bande, easting, northing + altitude (ex: 31U 448251 5411932, 120 m)
- Nom dâ€™un lieu/adresse ou plus code: je peux convertir, avec lâ€™altitude souhaitÃ©e

Si vous voulez rÃ©ellement aller Ã  48.85837, 2.29448, altitude 120 m, indiquez-le clairement. DÃ¨s rÃ©ception des coordonnÃ©es, je relance le dÃ©collage Ã  50 m, je vÃ©rifie les zones Ã  Ã©viter sur la trajectoire, puis jâ€™envoie le drone Ã  la destination Ã  lâ€™altitude indiquÃ©e (vitesse par dÃ©faut du drone).

âœˆï¸  GÃ©nÃ©ration du plan de vol...
   - CoordonnÃ©es disponibles: false
   - Ã‰tat initial disponible: false
   âš ï¸  Plan de vol non gÃ©nÃ©rÃ© (donnÃ©es insuffisantes)

ğŸ“¤ RÃ©ponse finale envoyÃ©e au client:
   - Message: Mise Ã  jour: jâ€™ai tentÃ© de faire dÃ©coller le drone Ã  50 m, mais la commande systÃ¨me a Ã©chouÃ©. Le dro...
   - Tool calls: 1
   - Plan de vol: 0 commandes
ğŸ¤– ========== FIN Ã‰CHANGE IA ==========


ğŸ¤– ========== DÃ‰BUT Ã‰CHANGE IA ==========
ğŸ“¤ Provider: Azure OpenAI
ğŸ“ Messages utilisateur: [
  {
    "role": "assistant",
    "content": "Bonjour ! Je suis votre assistant pour contrÃ´ler le drone. Comment puis-je vous aider ? Par exemple, vous pouvez me demander : \"Va voir si la centrale de Fessenheim a Ã©tÃ© touchÃ©e\""
  },
  {
    "role": "user",
    "content": "decolle en 1000 stp"
  }
]
ğŸ”§ System Prompt: Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :

1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les s...
ğŸ› ï¸  Tools disponibles: getCoordonnees, getEtatInitial, getZoneInterdite, planMissionRecon, takeOff, goTo, circle, capture, returnToHome, land, getStatus

ğŸ“¡ Appel initial Ã  l'IA...

ğŸŒ Appel API Azure OpenAI
   - Tool choice: auto
   - Nombre de messages: 3
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{},"finish_reason":"tool_calls","index":0,"logprobs":null,"message":{"annotations":[],"content":null,"refusal":null,"role":"assistant","tool_calls":[{"function":{"arguments":"{\"alt_m\":1000}","name":"takeOff"},"id":"call_k5U4Mg6b1rXWvxYBRsknH2yu","type":"function"}]}}],"created":1762542721,"id":"chatcmpl-CZMALs0zudhnHQMKTBRG1BNzxH8qz","model":"gpt-5-2025-08-07","object":"chat.completion","prompt_filter_results":[{"prompt_index":0,"content_filter_results":{"...
ğŸ“¥ RÃ©ponse IA reÃ§ue:
   - Contenu: (vide)
   - Tool calls: 1
   - Tool 1: takeOff
     Arguments: "{\"alt_m\":1000}"

ğŸ”„ Tour 1/5

ğŸ”§ 1 outil(s) Ã  exÃ©cuter:

âš™ï¸  ExÃ©cution: takeOff
   ParamÃ¨tres: {
  "alt_m": 1000
}
   âœ… RÃ©sultat: {
  "id": "cmd_1762542725679",
  "status": "success",
  "message": "DÃ©collage rÃ©ussi Ã  1000m",
  "data": {
    "altitude": 1000,
    "state": "hovering"
  }
}

ğŸ“Š Ã‰tat actuel:
   - CoordonnÃ©es rÃ©cupÃ©rÃ©es: false
   - Ã‰tat initial rÃ©cupÃ©rÃ©: false
   - Zones interdites rÃ©cupÃ©rÃ©es: false
   - Plans de mission gÃ©nÃ©rÃ©s: false
   - Nombre de sites: 0

ğŸ’¬ GÃ©nÃ©ration de la rÃ©ponse finale...
ğŸ“¤ Contexte complet: 6 messages
   - Tool calls effectuÃ©s: 1
   - RÃ©flexion IA: (aucune)

ğŸŒ Appel API Azure OpenAI
   - Tool choice: none
   - Nombre de messages: 6
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{"hate":{"filtered":false,"severity":"safe"},"protected_material_code":{"filtered":false,"detected":false},"protected_material_text":{"filtered":false,"detected":false},"self_harm":{"filtered":false,"severity":"safe"},"sexual":{"filtered":false,"severity":"safe"},"violence":{"filtered":false,"severity":"safe"}},"finish_reason":"stop","index":0,"logprobs":null,"message":{"annotations":[],"content":"DÃ©collage effectuÃ©. Le drone est maintenant en vol stationnai...
ğŸ“¥ RÃ©ponse finale IA:
   - Contenu: DÃ©collage effectuÃ©. Le drone est maintenant en vol stationnaire Ã  1000 m dâ€™altitude.

Etat actuel:
- Altitude: 1000 m
- Statut: stationnaire

Remarques importantes:
- Une altitude de 1000 m peut dÃ©passer les limites lÃ©gales dans de nombreuses zones. Assurez-vous de disposer des autorisations nÃ©cessaires et de respecter lâ€™espace aÃ©rien local.
- Les vents peuvent Ãªtre plus forts Ã  cette altitude; surveillez la marge de sÃ©curitÃ© et lâ€™autonomie.

Prochaines actions possibles (dites-moi laquelle exÃ©cuter):
- Maintenir le vol stationnaire Ã  1000 m
- Se rendre Ã  une position prÃ©cise (donnez un nom de site ou des coordonnÃ©es)
- Effectuer une orbite autour dâ€™une cible
- DÃ©marrer une capture (photo/vidÃ©o)
- Revenir au point de dÃ©part ou atterrir

Si vous souhaitez inspecter un site, indiquez son nom et je lancerai immÃ©diatement la reconnaissance avec planification automatique de la mission et prise en compte des zones interdites.

âœˆï¸  GÃ©nÃ©ration du plan de vol...
   - CoordonnÃ©es disponibles: false
   - Ã‰tat initial disponible: false
   âš ï¸  Plan de vol non gÃ©nÃ©rÃ© (donnÃ©es insuffisantes)

ğŸ“¤ RÃ©ponse finale envoyÃ©e au client:
   - Message: DÃ©collage effectuÃ©. Le drone est maintenant en vol stationnaire Ã  1000 m dâ€™altitude.

Etat actuel:
-...
   - Tool calls: 1
   - Plan de vol: 0 commandes
ğŸ¤– ========== FIN Ã‰CHANGE IA ==========

 POST /api/chat 200 in 25374ms

ğŸ¤– ========== DÃ‰BUT Ã‰CHANGE IA ==========
ğŸ“¤ Provider: Azure OpenAI
ğŸ“ Messages utilisateur: [
  {
    "role": "assistant",
    "content": "Bonjour ! Je suis votre assistant pour contrÃ´ler le drone. Comment puis-je vous aider ? Par exemple, vous pouvez me demander : \"Va voir si la centrale de Fessenheim a Ã©tÃ© touchÃ©e\""
  },
  {
    "role": "user",
    "content": "decolle en 1000 stp"
  },
  {
    "role": "assistant",
    "content": "DÃ©collage effectuÃ©. Le drone est maintenant en vol stationnaire Ã  1000 m dâ€™altitude.\n\nEtat actuel:\n- Altitude: 1000 m\n- Statut: stationnaire\n\nRemarques importantes:\n- Une altitude de 1000 m peut dÃ©passer les limites lÃ©gales dans de nombreuses zones. Assurez-vous de disposer des autorisations nÃ©cessaires et de respecter lâ€™espace aÃ©rien local.\n- Les vents peuvent Ãªtre plus forts Ã  cette altitude; surveillez la marge de sÃ©curitÃ© et lâ€™autonomie.\n\nProchaines actions possibles (dites-moi laquelle exÃ©cuter):\n- Maintenir le vol stationnaire Ã  1000 m\n- Se rendre Ã  une position prÃ©cise (donnez un nom de site ou des coordonnÃ©es)\n- Effectuer une orbite autour dâ€™une cible\n- DÃ©marrer une capture (photo/vidÃ©o)\n- Revenir au point de dÃ©part ou atterrir\n\nSi vous souhaitez inspecter un site, indiquez son nom et je lancerai immÃ©diatement la reconnaissance avec planification automatique de la mission et prise en compte des zones interdites."
  },
  {
    "role": "user",
    "content": "va en latitude, longitude, altitude_m (ex: 48.85837, 2.29448, 120) stp"
  }
]
ğŸ”§ System Prompt: Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :

1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les s...
ğŸ› ï¸  Tools disponibles: getCoordonnees, getEtatInitial, getZoneInterdite, planMissionRecon, takeOff, goTo, circle, capture, returnToHome, land, getStatus

ğŸ“¡ Appel initial Ã  l'IA...

ğŸŒ Appel API Azure OpenAI
   - Tool choice: auto
   - Nombre de messages: 5
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{},"finish_reason":"tool_calls","index":0,"logprobs":null,"message":{"annotations":[],"content":null,"refusal":null,"role":"assistant","tool_calls":[{"function":{"arguments":"{\"lat\":48.85837,\"lon\":2.29448,\"alt_m\":120}","name":"goTo"},"id":"call_JnXHbvarGHgr0SaMXSWqhLE3","type":"function"}]}}],"created":1762542757,"id":"chatcmpl-CZMAv1XNWXeWSQSFJARgaNpFj2q0K","model":"gpt-5-2025-08-07","object":"chat.completion","prompt_filter_results":[{"prompt_index":...
ğŸ“¥ RÃ©ponse IA reÃ§ue:
   - Contenu: (vide)
   - Tool calls: 1
   - Tool 1: goTo
     Arguments: "{\"lat\":48.85837,\"lon\":2.29448,\"alt_m\":120}"

ğŸ”„ Tour 1/5

ğŸ”§ 1 outil(s) Ã  exÃ©cuter:

âš™ï¸  ExÃ©cution: goTo
   ParamÃ¨tres: {
  "lat": 48.85837,
  "lon": 2.29448,
  "alt_m": 120
}
   âœ… RÃ©sultat: {
  "id": "cmd_1762542762953",
  "status": "error",
  "message": "Erreur dÃ©placement: moveTo() missing 2 required positional arguments: 'orientation_mode' and 'heading'",
  "data": {}
}

ğŸ“Š Ã‰tat actuel:
   - CoordonnÃ©es rÃ©cupÃ©rÃ©es: false
   - Ã‰tat initial rÃ©cupÃ©rÃ©: false
   - Zones interdites rÃ©cupÃ©rÃ©es: false
   - Plans de mission gÃ©nÃ©rÃ©s: false
   - Nombre de sites: 0

ğŸ’¬ GÃ©nÃ©ration de la rÃ©ponse finale...
ğŸ“¤ Contexte complet: 8 messages
   - Tool calls effectuÃ©s: 1
   - RÃ©flexion IA: (aucune)

ğŸŒ Appel API Azure OpenAI
   - Tool choice: none
   - Nombre de messages: 8
   - Nombre de tools: 11
   ğŸ“¤ RequÃªte HTTP:
      URL: https://bapti-m70vyuu5-eastus2.openai.azure.com/openai/deployments/gpt-5-EDTH/chat/completions?api-version=2025-01-01-preview
      Headers: { 'Content-Type': 'application/json', 'api-key': '***' }
      Body (preview): {"messages":[{"role":"system","content":"Tu es un assistant expert pour contrÃ´ler un drone. Quand l'utilisateur demande une mission (inspection, reconnaissance, etc.), tu DOIS automatiquement :\n\n1. RÃ©cupÃ©rer les coordonnÃ©es GPS de tous les sites mentionnÃ©s avec getCoordonnees\n2. RÃ©cupÃ©rer l'Ã©tat initial du drone avec getEtatInitial (point de dÃ©part, altitude, vitesse)\n3. VÃ©rifier les zones interdites avec getZoneInterdite\n4. Pour CHAQUE site, gÃ©nÃ©rer un plan de mission avec planMissionRecon...
   ğŸ“¥ RÃ©ponse API reÃ§ue (preview): {"choices":[{"content_filter_results":{"hate":{"filtered":false,"severity":"safe"},"protected_material_code":{"filtered":false,"detected":false},"protected_material_text":{"filtered":false,"detected":false},"self_harm":{"filtered":false,"severity":"safe"},"sexual":{"filtered":false,"severity":"safe"},"violence":{"filtered":false,"severity":"safe"}},"finish_reason":"stop","index":0,"logprobs":null,"message":{"annotations":[],"content":"Compris. Jâ€™ai tentÃ© dâ€™envoyer le drone vers 48.85837, 2.29448...
ğŸ“¥ RÃ©ponse finale IA:
   - Contenu: Compris. Jâ€™ai tentÃ© dâ€™envoyer le drone vers 48.85837, 2.29448 Ã  120 m, mais la commande de dÃ©placement a Ã©tÃ© rejetÃ©e par lâ€™autopilote faute de paramÃ¨tres de navigation requis (cap et mode dâ€™orientation). Aucun dÃ©placement nâ€™a eu lieu; le drone reste en vol stationnaire Ã  son altitude actuelle.

Pour exÃ©cuter correctement la navigation, il faut prÃ©ciser:
- Cap (heading): en degrÃ©s 0â€“359 (ex. 0Â° = nord, 90Â° = est).
- Mode dâ€™orientation (yaw): par exemple, nez alignÃ© avec la trajectoire (â€œcourse-lockâ€), maintien du yaw actuel, ou nez dirigÃ© vers la cible Ã  lâ€™arrivÃ©e.

Proposition prÃªte Ã  Ãªtre exÃ©cutÃ©e (si vous validez ces paramÃ¨tres):
- Destination: 48.85837, 2.29448
- Altitude cible: 120 m (descente progressive si altitude actuelle > 120 m)
- Cap: automatique vers le waypoint (ajustÃ© en temps rÃ©el)
- Orientation: nez alignÃ© avec la trajectoire (course-lock)
- Vitesse: modÃ©rÃ©e pour zone urbaine (par ex. 10 m/s), avec rÃ©duction Ã  lâ€™approche

Point sÃ©curitÃ© important:
- La zone autour de la Tour Eiffel (coordonnÃ©es indiquÃ©es) est soumise Ã  de fortes restrictions aÃ©riennes. Un vol de drone y est gÃ©nÃ©ralement interdit sans autorisation spÃ©cifique. Assurez-vous de respecter la rÃ©glementation et les Ã©ventuelles zones dâ€™exclusion.

Indiquez simplement le cap souhaitÃ© (en degrÃ©s) ou dites â€œcap autoâ€ et â€œorientation trajectoireâ€ pour que je lance immÃ©diatement le dÃ©placement avec ces paramÃ¨tres.

âœˆï¸  GÃ©nÃ©ration du plan de vol...
   - CoordonnÃ©es disponibles: false
   - Ã‰tat initial disponible: false
   âš ï¸  Plan de vol non gÃ©nÃ©rÃ© (donnÃ©es insuffisantes)

ğŸ“¤ RÃ©ponse finale envoyÃ©e au client:
   - Message: Compris. Jâ€™ai tentÃ© dâ€™envoyer le drone vers 48.85837, 2.29448 Ã  120 m, mais la commande de dÃ©placeme...
   - Tool calls: 1
   - Plan de vol: 0 commandes
ğŸ¤– ========== FIN Ã‰CHANGE IA ==========

 POST /api/chat 200 in 28438ms
^C